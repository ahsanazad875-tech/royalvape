<div class="card product-card">
  <div class="card-body">

    <!-- Header Row -->
    <div class="d-flex align-items-center mb-3 product-header">
      <button
        *ngIf="isAdmin"
        abpPermission="POS.Products.Create"
        class="btn btn-primary btn-add-product"
        [routerLink]="['/products/edit']"
      >
        <i class="fa fa-plus me-1"></i> Create Product
      </button>

      <div class="ms-auto small text-muted product-total">
        Total: <strong>{{ total }}</strong>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive product-table-container">
      <table class="table table-striped align-middle product-table">
        <thead>
          <tr>
            <th class="col-name">Name</th>
            <th class="col-type">Type</th>
            <th class="col-uom">UoM</th>
            <th class="col-created-date">Created Date</th>
            <th class="col-created-by">Created By</th>
            <th class="col-buy-price">Buying Price</th>
            <th class="col-sell-price">Selling Price</th>
            <th class="col-updated-date">Updated Date</th>
            <th class="col-updated-by">Updated By</th>
            <th class="col-actions" *ngIf="isAdmin"></th>
          </tr>
        </thead>

        <tbody>
          <!-- Loading -->
          <tr *ngIf="loading">
            <td colspan="10" class="text-center py-4 loading-row">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Loading…
            </td>
          </tr>

          <!-- No Data -->
          <tr *ngIf="!loading && items.length === 0">
            <td colspan="10" class="text-center text-muted py-4 no-data-row">
              No products found.
            </td>
          </tr>

          <!-- Data Rows -->
          <tr *ngFor="let p of items; trackBy: trackById" class="product-row">
            <td class="product-name-cell">
              <img
                class="product-thumbnail me-2"
                *ngIf="imgSrc(p) as src; else prodIcon"
                [src]="src"
                width="36"
                height="36"
                loading="lazy"
                [alt]="p.productName || 'Product'"
              />
              {{ p.productNo + ' ' + p.productName }}
            </td>
            <td>{{ p.productTypeName }}</td>
            <td>{{ UoMEnumMap[p.uoM] ?? p.uoM }}</td>
            <td>{{ p.creationTime | date:'dd MMM yyyy HH:mm' }}</td>
            <td>{{ p.creatorName }}</td>
            <td>{{ p.buyingUnitPrice }}</td>
            <td>{{ p.sellingUnitPrice }}</td>
            <td>{{ p.lastModificationTime | date:'dd MMM yyyy HH:mm' }}</td>
            <td>{{ p.modifiedBy }}</td>

            <td class="text-end product-actions" *ngIf="isAdmin">
              <a
                class="btn btn-sm btn-outline-secondary product-edit-btn"
                abpPermission="POS.Products.Edit"
                [routerLink]="['/products/edit', p.id]"
              >
                <i class="fa fa-edit"></i>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Fallback Icon -->
    <ng-template #prodIcon>
      <span class="product-placeholder-icon me-2">
        <i class="fa fa-box"></i>
      </span>
    </ng-template>

    <!-- Pagination -->
    <div
      class="d-flex flex-wrap align-items-center justify-content-between mt-3 gap-2 pagination-container"
      *ngIf="total > 0"
    >
      <!-- Rows Per Page -->
      <div class="d-flex align-items-center gap-2 pagination-rows">
        <span class="small text-muted">Rows per page</span>

        <select
          class="form-select form-select-sm w-auto pagination-select"
          [value]="pageSize"
          (change)="onPageSizeChange($any($event.target).value)"
        >
          <option [value]="10">10</option>
          <option [value]="20">20</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>

      <!-- Count -->
      <div class="small text-muted pagination-count">
        {{ visibleFrom }}–{{ visibleTo }} of {{ total }}
      </div>

      <!-- Page Navigation -->
      <div class="d-flex align-items-center gap-2 pagination-buttons">
        <button
          class="btn btn-sm btn-outline-secondary pagination-btn"
          (click)="changePage(-1)"
          [disabled]="pageIndex === 0 || loading"
        >
          ‹ Prev
        </button>

        <span class="small pagination-page">Page {{ pageIndex + 1 }}</span>

        <button
          class="btn btn-sm btn-outline-secondary pagination-btn"
          (click)="changePage(1)"
          [disabled]="visibleTo >= total || loading"
        >
          Next ›
        </button>
      </div>
    </div>
  </div>
</div>